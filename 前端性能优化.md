# 前端性能优化

## 自我埋坑

- 掌握如何通过webpack 实现压缩和合并的方法
- 用webpack实现打包构建的时候将png或jpg转成webp格式



## 资源的合并与压缩

### 理解减少http请求数量和减少请求资源大小两个优化要点

#### 浏览器的一个请求从发送都返回都经历了什么？

- dns是否可以通过缓存来减少dns查询时间

- 网络请求是否走最近的网络环境

- 相同的静态资源是否可以缓存（CDN, 或者本地）

- 能否减少http请求的大小

- 减少http请求的数量

- 服务端渲染

  **深入理解htttp请求的过程，是前端性能优化的核心**



### 掌握压缩和合并的原理

#### 资源的合并与压缩

1. 减少http请求数量
2. 减少http请求大小

#### google首页案例

- html压缩 ： 压缩在html解析中无用的空格，制表符，换行符和html注释等
- css压缩： 无效代码删除、 css语义合并
- js的压缩和混乱： 无效字符删除、剔除注释、 代码语义的缩减和优化、 代码保护
- 文件合并
- 开启gzip

#### 如何html压缩 *

1. 使用在线网站进行压缩（废弃： 不符合现代化前端构建工具方案）
2. node.js 提供的 **html-minifier**工具（可以构建工具做，可以node服务端做）
3. 后端模板引擎渲染压缩（例如ejs  等）

#### 如何css压缩 **

1. 使用在线网站进行压缩（废弃： 不符合现代化前端构建工具方案）
2. node.js 提供的 **html-minifier**工具对html中的css进行压缩 
3. 使用clean-css对css进行压缩

#### 如何JS压缩和混乱 ***

1. 使用在线网站进行压缩（废弃： 不符合现代化前端构建工具方案）
2. node.js 提供的 **html-minifier**工具对html中的js进行压缩 
3. 使用uglifyjs2对js进行压缩

以上这3种类压缩， 最好都是在构建工具就直接完成



#### 文件不合并的影响

- 文件与文件间有插入的上行请求，增加了N-1个网络延时
- 受丢包问题的影响更加严重
- 经过代理服务器可能会被断开

![](C:\mycode\project\doc\images\optimization\文件合并.png)



#### 文件合并存在的问题

- 首屏渲染问题 ： 合并后的js 过大，导致依赖的js迟迟无法加载，而阻塞渲染
- 缓存失效问题： 比如a.js、b.js、c.js  被合并成 d[hash].js, 那么对与a、b、c任意一个文件的修改，都会导致打包后的d[hash].js 文件名改变，从而使得缓存大面积失效。
- 解决办法： 
- 公共库合并：  公共库打包在一起，业务代码打包在一起
- 不同页面合并：  不同页面的js 分别打包
- 见机行事，随机应变

#### 如何进行文件合并

1. 使用在线网站进行压缩（废弃： 不符合现代化前端构建工具方案）
2. 使用node.js 工具实现文件合并： 比如webpack  glup 等

### <font color='red'> 掌握如何通过webpack 实现压缩和合并的方法  </font>

具体就是如何写webpack 配置了----见自己的webpack文档吧（填坑！！！！）



### 总结

- 发现 http 请求过程以及其中潜在的性能优化点
- 压缩与合并和混乱的基本使用





## 图片相关优化

### 理解图片优化相关的核心概念

#### jpg 有损压缩

##### png8、png24、 png32之间的区别

- png8	------256色 + 支持透明

- png24	------2^24色 + 不支持透明

- png8	------2^24色 + 支持透明

- png 无损压缩

  总结： 每种图片类型都有自己的特点，根据不同的业务场景选择不同的图片格式

##### 不同格式图片常用的业务场景
- jpg 有损压缩， 压缩率高，不支持透明 ：   大部分不需要透明图片的场景
- png(常用) 支持透明，浏览器兼容性好  ：   大部分需要透明图片的场景
- webpg压缩程度更好，在ios和webview有兼容性问题：  安卓全部支持
- svg矢量图，代码内嵌，相对较小，图片样式相对简单的场景：  图片样式相对简单的业务场景
- gif:   支持动画这个特点，无可替代

##### 图片压缩（舍弃一些不重要的色彩信息）



##### css雪碧图

- 优点： 减少http请求的数量
- 缺点： 整合图片比较大时 ，雪碧图失效或者加载慢影响范围大

##### image inline（推荐，常用）

- (在构建阶段) 将图片的内容内嵌到html中（以base64方式内嵌），减少http请求

##### 使用svg图（推荐，常用）

- 使用SVG代码方式进行矢量图绘制
- 使用iconfont解决icon问题

##### 安卓下使用webp

- 具有更优的图片压缩算法，体积更小
- 肉眼无差别的图片质量
- 同时具备无损和有损压缩模式
- 支持透明+动画
- 在jpeg和png上转换效果都非常优秀、稳定和统一



### 结合案例分析

##### facebook网站

- 根据业务区分了不同的雪碧图

##### 淘宝webview版

- 一些小的icon 采用了图片内联的方式
- 根据不同的手机系统平台采用不同的格式，  比如安卓或chrome就用webp，否者就使用jpg图片

##### 图片在线压缩网站

- www.tinypng.com

### 优化实战

- 使用在线网站将png转成webp格式
- 埋坑： 用webpack实现打包构建的时候将png或jpg转成webp格式
- 如果一个图片小于8kb, 就可以考虑将它做成Image inline



